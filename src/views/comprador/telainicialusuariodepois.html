<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Gest√£o</title>
    <!-- Tailwind CSS CDN para estiliza√ß√£o -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js para o gr√°fico de barras -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- Leaflet para o mapa -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Flatpickr para o calend√°rio e seletor de datas -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <!-- html2canvas e jspdf para gerar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f5;
        }
        /* Cores personalizadas para o tema */
        .text-brown-custom { color: #8B4513; }
        .bg-brown-custom { background-color: #8B4513; }
        .bg-orange-custom { background-color: #d4a574; }
        .border-brown-custom { border-color: #8B4513; }
        .bg-gray-custom { background-color: #f5f5f5; }

        /* Estilos do Flatpickr para combinar com o tema */
        .flatpickr-calendar {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            border: 1px solid #e0e0e0;
        }
        .flatpickr-day.selected, .flatpickr-day.donated-day {
            background: #8B4513 !important;
            border-color: #8B4513 !important;
            color: white !important;
            font-weight: bold;
        }
        .flatpickr-day.selected.startRange, .flatpickr-day.selected.endRange {
            border-radius: 12px !important;
        }
        .flatpickr-day.today.selected {
            background-color: #d4a574 !important;
            border-color: #d4a574 !important;
        }
        .flatpickr-day.donated-day:hover {
            background: #d4a574 !important;
            border-color: #d4a574 !important;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .donated-day {
            background-color: #8B4513 !important;
            color: white !important;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Loading overlay for PDF generation -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-brown-custom"></div>
        <p class="mt-4 text-brown-custom font-semibold">Gerando PDF...</p>
    </div>

    <!-- Container principal -->
    <div id="dashboard-content">
        <!-- Header and Main Chart Section -->
        <div class="bg-white p-6 shadow-sm rounded-2xl max-w-7xl mx-auto mt-6 mb-6">
            <header class="flex justify-between items-center mb-4">
                <!-- Bot√£o "Gerar PDF" movido para a direita -->
                <button id="generate-pdf-btn" class="bg-orange-custom text-white text-sm px-4 py-2 rounded-full font-medium hover:bg-brown-custom transition-colors">Gerar PDF</button>
                <div class="flex items-center gap-4 text-gray-600 font-semibold">
                    <!-- Filtros de per√≠odo e seletor de data agrupados -->
                    <div id="filter-container" class="flex items-center gap-0 text-gray-600 font-semibold">
                        <span id="filter-day" class="cursor-pointer border border-gray-300 p-2 rounded-l-lg">Dia</span>
                        <span id="filter-week" class="cursor-pointer border-y border-gray-300 p-2">Semana</span>
                        <span id="filter-month" class="cursor-pointer border-y border-gray-300 p-2 text-white bg-brown-custom">M√™s</span>
                        <span id="filter-year" class="cursor-pointer border border-gray-300 p-2 rounded-r-lg">Ano</span>
                    </div>
                    <div id="date-picker-trigger" class="flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-gray-100 transition-colors border border-gray-300">
                        <span id="start-date-display" class="text-sm">dd/mm/aaaa</span>
                        <span>-</span>
                        <span id="end-date-display" class="text-sm">dd/mm/aaaa</span>
                        <input type="text" id="date-range-input" class="hidden">
                    </div>
                </div>
            </header>
            <!-- Gr√°fico de Doa√ß√µes -->
            <div class="h-96">
                <h5 class="font-semibold text-gray-800 mb-4">Doa√ß√µes por M√™s</h5>
                <canvas id="barChart" class="w-full h-full"></canvas>
            </div>
        </div>
        
        <!-- Sub-header -->
        <nav class="bg-white p-4 shadow-sm mb-6 max-w-7xl mx-auto rounded-2xl">
            <div class="flex flex-wrap gap-4 text-gray-600 font-medium">
                <a href="#" class="px-3 py-1 rounded-full bg-brown-custom text-white shadow">Relat√≥rios</a>
                <a href="#" class="px-3 py-1 rounded-full hover:bg-gray-100">Contratos</a>
                <a href="#" class="px-3 py-1 rounded-full hover:bg-gray-100">Notas de escrit√≥rio</a>
                <a href="#" class="px-3 py-1 rounded-full hover:bg-gray-100">Documentos comprovativos</a>
                <a href="#" class="px-3 py-1 rounded-full hover:bg-gray-100">Gest√£o financeira</a>
                <a href="#" class="px-3 py-1 rounded-full hover:bg-gray-100">Parceiros</a>
            </div>
        </nav>
        
        <!-- Main Content Grid -->
        <div class="p-6 grid grid-cols-1 lg:grid-cols-3 gap-6 max-w-7xl mx-auto">
            
            <!-- Left Column -->
            <aside class="col-span-1 flex flex-col gap-6">
                <!-- Mapa de Riscos -->
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h3 class="text-gray-800 font-semibold mb-4">Mapa de riscos</h3>
                    <nav class="flex flex-col gap-2 text-gray-600">
                        <a href="#" class="py-2 hover:text-brown-custom transition-colors">Pontos para a coleta</a>
                        <a href="#" class="py-2 hover:text-brown-custom transition-colors">Onde eu fa√ßo a doa√ß√£o</a>
                        <a href="#" class="py-2 hover:text-brown-custom transition-colors">Previs√£o de d√≠vida</a>
                        <a href="#" class="py-2 hover:text-brown-custom transition-colors">Nossos gastos</a>
                        <a href="#" class="py-2 hover:text-brown-custom transition-colors">Nossa equipe</a>
                        <a href="#" class="py-2 hover:text-brown-custom transition-colors">Nossos parceiros</a>
                    </nav>
                </div>

                <!-- Calend√°rio -->
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h3 class="text-gray-800 font-semibold mb-4">Agenda</h3>
                    <input type="text" id="calendar" class="w-full text-center text-brown-custom font-semibold">
                </div>

            </aside>

            <!-- Right Column -->
            <main class="col-span-1 lg:col-span-2 flex flex-col gap-6">
                <!-- Mapa de Rotas -->
                <div class="bg-white p-6 rounded-2xl shadow-lg h-72">
                    <h3 class="text-gray-800 font-semibold mb-4">Mapa de rotas</h3>
                    <div id="map" class="w-full h-full rounded-xl"></div>
                </div>
                
                <!-- Cards alinhados: User Info e Agenda -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Informa√ß√µes do Usu√°rio -->
                    <div class="bg-white p-6 rounded-2xl shadow-lg flex flex-col justify-between">
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-semibold">Nome do usu√°rio</span>
                                <span class="text-sm text-gray-500">Setembro 05/09/2025</span>
                            </div>
                            <!-- O bot√£o "Excluir" foi removido. O bot√£o "Editar perfil" agora √© um link -->
                            <div class="flex gap-2 mb-4">
                                <a href="#" class="bg-gray-100 text-gray-600 px-4 py-2 rounded-lg font-medium">‚úèÔ∏è Editar perfil</a>
                            </div>
                            <div class="bg-orange-custom text-white px-4 py-2 rounded-lg text-xs mb-2 text-center">Produto selecionado - Argentina</div>
                            <div class="bg-brown-custom text-white px-4 py-2 rounded-lg text-xs text-center">Sistema programa</div>
                        </div>
                    </div>
                    
                    <!-- Daily Schedule / Agenda -->
                    <div class="bg-white p-6 rounded-2xl shadow-lg flex flex-col justify-between">
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-semibold">Hoje</span>
                                <span class="text-sm text-gray-500" id="current-date"></span>
                            </div>
                            <div class="flex flex-col gap-2 overflow-y-auto max-h-48" id="pending-donations-list">
                                <!-- Doa√ß√µes pendentes ser√£o renderizadas aqui -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Cards alinhados: Pontos de Abrigo e Listas de Doa√ß√µes -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Pontos de Abrigo -->
                    <div class="bg-white p-6 rounded-2xl shadow-lg flex flex-col justify-between">
                        <div>
                            <h5 class="font-semibold text-gray-800 mb-4">Pontos de Abrigo</h5>
                            <div class="flex flex-col gap-3">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <span class="w-2.5 h-2.5 bg-green-500 rounded-full"></span>
                                        <span class="text-sm">Ponto de abrigo x</span>
                                    </div>
                                    <span class="text-xs text-gray-500">Aberto</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <span class="w-2.5 h-2.5 bg-gray-400 rounded-full"></span>
                                        <span class="text-sm">Ponto de abrigo x</span>
                                    </div>
                                    <span class="text-xs text-gray-500">Fechado</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <span class="w-2.5 h-2.5 bg-green-500 rounded-full"></span>
                                        <span class="text-sm">Ponto de abrigo x</span>
                                    </div>
                                    <span class="text-xs text-gray-500">Aberto</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Donation Lists -->
                    <div class="bg-white p-6 rounded-2xl shadow-lg flex flex-col justify-between">
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-semibold text-gray-800">13 Doa√ß√µes - Alimentos</span>
                                <div id="alimentos-count" class="w-2 h-2 bg-brown-custom rounded-full"></div>
                            </div>
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-semibold text-gray-800">12 Doa√ß√µes - Produtos de Higiene</span>
                                <div id="higiene-count" class="w-2 h-2 bg-brown-custom rounded-full"></div>
                            </div>
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-semibold text-gray-800">9 Doa√ß√µes - Ra√ß√£o de animais</span>
                                <div id="racao-count" class="w-2 h-2 bg-brown-custom rounded-full"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Porcentagem de Doa√ß√£o -->
                <div class="bg-white p-6 rounded-2xl shadow-lg flex flex-col justify-center items-center text-center">
                    <div class="text-4xl text-brown-custom mb-2">üëç</div>
                    <div>
                        <p class="text-sm text-gray-600">Percentual de doa√ß√£o no ano:</p>
                        <h3 class="font-bold text-3xl text-brown-custom">50%</h3>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal para detalhes da doa√ß√£o -->
    <div id="donation-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center p-4 z-[1000]">
        <div class="bg-white p-6 rounded-2xl shadow-lg w-full max-w-sm">
            <div class="flex justify-between items-center mb-4">
                <h4 class="text-xl font-bold text-gray-800">Detalhes da Doa√ß√£o</h4>
                <button id="close-modal" class="text-gray-500 hover:text-gray-800 text-2xl font-bold leading-none">&times;</button>
            </div>
            <div class="flex flex-col gap-4">
                <div>
                    <p class="text-sm text-gray-600">Data:</p>
                    <h5 id="modal-date" class="text-md font-semibold text-brown-custom"></h5>
                </div>
                <div>
                    <p class="text-sm text-gray-600">Quantidade:</p>
                    <h5 id="modal-amount" class="text-lg font-bold text-gray-800"></h5>
                </div>
                <div>
                    <p class="text-sm text-gray-600">Tipo de Doa√ß√£o:</p>
                    <h5 id="modal-type" class="text-lg font-bold text-gray-800"></h5>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados de doa√ß√£o confirmados
        let confirmedDonations = {
            "2025-09-08": { id: 1, amount: "100kg", type: "Roupas" },
            "2025-09-15": { id: 2, amount: "50kg", type: "Alimentos" },
            "2025-09-22": { id: 3, amount: "20kg", type: "Brinquedos" },
            "2025-09-29": { id: 4, amount: "75kg", type: "Rem√©dios" },
            "2025-10-05": { id: 5, amount: "150kg", type: "Equipamentos" }
        };

        // Doa√ß√µes pendentes de confirma√ß√£o
        let pendingDonations = [
            { id: 6, date: "2025-09-08", time: "10:00", amount: "30kg", type: "Alimentos", status: "Pendente" },
            { id: 7, date: "2025-09-08", time: "14:30", amount: "15kg", type: "Produtos de Higiene", status: "Pendente" },
        ];

        // Mapeamento de tipos de doa√ß√£o para contagens
        let donationCounts = {
            "Alimentos": 13,
            "Produtos de Higiene": 12,
            "Ra√ß√£o de animais": 9,
            "Roupas": 0,
            "Brinquedos": 0,
            "Rem√©dios": 0,
            "Equipamentos": 0
        };
        
        // Mapeamento de meses para dados do gr√°fico
        let chartDataByMonth = {
            'Janeiro': 6, 'Fevereiro': 5, 'Mar√ßo': 3, 'Abril': 2, 'Maio': 1, 'Junho': 3.5, 
            'Julho': 5, 'Agosto': 4.8, 'Setembro': 3.5, 'Outubro': 2.5, 'Novembro': 4, 'Dezembro': 3
        };

        const donationDates = Object.keys(confirmedDonations);
        const donationModal = document.getElementById('donation-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const modalDate = document.getElementById('modal-date');
        const modalAmount = document.getElementById('modal-amount');
        const modalType = document.getElementById('modal-type');
        const generatePdfBtn = document.getElementById('generate-pdf-btn');
        const loadingOverlay = document.getElementById('loading-overlay');
        const pendingDonationsList = document.getElementById('pending-donations-list');
        
        // Novo objeto global para armazenar os dados e o t√≠tulo atuais do gr√°fico
        let currentChartData = {
            labels: [],
            data: [],
            title: ''
        };

        // Adiciona a data atual na se√ß√£o "Hoje"
        document.getElementById('current-date').innerText = new Date().toLocaleDateString('pt-BR');

        // Fun√ß√£o para renderizar as doa√ß√µes pendentes
        function renderPendingDonations() {
            pendingDonationsList.innerHTML = ''; // Limpa a lista
            if (pendingDonations.length === 0) {
                pendingDonationsList.innerHTML = `<div class="p-2 text-center text-gray-500">Nenhuma doa√ß√£o pendente.</div>`;
            } else {
                pendingDonations.forEach(donation => {
                    const donationItem = document.createElement('div');
                    donationItem.className = 'flex items-center justify-between p-2 bg-gray-custom rounded-lg shadow-sm';
                    donationItem.innerHTML = `
                        <div>
                            <p class="text-sm font-semibold">${donation.type}</p>
                            <p class="text-xs text-gray-600">${donation.amount} - ${donation.time}</p>
                        </div>
                        <button class="bg-brown-custom text-white text-xs px-3 py-1 rounded-full hover:bg-orange-custom transition-colors" onclick="confirmDonation(${donation.id})">Confirmar</button>
                    `;
                    pendingDonationsList.appendChild(donationItem);
                });
            }
        }
        
        // Fun√ß√£o para atualizar as contagens de doa√ß√£o
        function updateDonationCounts() {
            for (const type in donationCounts) {
                const element = document.getElementById(`${type.toLowerCase().replace(/ /g, '-').replace('√ß','c').replace('√£','a')}-count`);
                if (element) {
                    element.parentElement.querySelector('span').innerText = `${donationCounts[type]} Doa√ß√µes - ${type}`;
                }
            }
        }

        // Fun√ß√£o para atualizar o gr√°fico com novos dados
        function updateChartWithNewData() {
            const labels = Object.keys(chartDataByMonth);
            const data = Object.values(chartDataByMonth);
            myChart.data.labels = labels;
            myChart.data.datasets[0].data = data;
            myChart.options.scales.y.ticks.max = Math.max(...data) + 1;
            myChart.update();
            currentChartData.labels = labels;
            currentChartData.data = data;
            currentChartData.title = 'Doa√ß√µes por M√™s';
        }

        // Fun√ß√£o para confirmar uma doa√ß√£o
        window.confirmDonation = (id) => {
            const donationIndex = pendingDonations.findIndex(d => d.id === id);
            if (donationIndex > -1) {
                const donation = pendingDonations.splice(donationIndex, 1)[0];
                confirmedDonations[donation.date] = donation;

                // Atualiza a agenda (Flatpickr)
                updateCalendar();

                // Atualiza o gr√°fico (simulado)
                const month = new Date(donation.date).toLocaleString('pt-BR', { month: 'long' });
                chartDataByMonth[month] = (chartDataByMonth[month] || 0) + 1; // Incrementa a doa√ß√£o no m√™s
                updateChartWithNewData();

                // Atualiza a lista de tipos de doa√ß√£o
                if (donationCounts[donation.type] !== undefined) {
                    donationCounts[donation.type]++;
                } else {
                    donationCounts[donation.type] = 1;
                }
                updateDonationCounts();

                // Re-renderiza a lista de pendentes
                renderPendingDonations();
            }
        };

        function updateCalendar() {
            const newDonationDates = Object.keys(confirmedDonations);
            flatpickr("#calendar", {
                inline: true,
                locale: "pt",
                dateFormat: "d/m/Y",
                enable: newDonationDates,
                onDayCreate: (dObj, dStr, fp, dayElem) => {
                    const date = new Date(dayElem.dateObj);
                    const formattedDate = date.getFullYear() + "-" + ("0" + (date.getMonth() + 1)).slice(-2) + "-" + ("0" + date.getDate()).slice(-2);
                    
                    if (newDonationDates.includes(formattedDate)) {
                        dayElem.classList.add("donated-day");
                        dayElem.onclick = (e) => {
                            e.stopPropagation();
                            showDonationDetails(formattedDate);
                        };
                    }
                }
            });
        }
        
        // Configura√ß√£o do Flatpickr para sele√ß√£o de intervalo de datas
        flatpickr("#date-range-input", {
            mode: "range",
            dateFormat: "d/m/Y",
            locale: "pt",
            onClose: (selectedDates, dateStr, instance) => {
                if (selectedDates.length === 2) {
                    const startDate = selectedDates[0];
                    const endDate = selectedDates[1];
                    document.getElementById('start-date-display').innerText = startDate.toLocaleDateString('pt-BR');
                    document.getElementById('end-date-display').innerText = endDate.toLocaleDateString('pt-BR');
                    updateChartData('range', { startDate, endDate });
                    // Remove a classe de sele√ß√£o dos filtros fixos
                    document.querySelectorAll('#filter-container span').forEach(span => {
                        span.classList.remove('text-brown-custom', 'border-b-2', 'border-brown-custom');
                        span.classList.remove('bg-brown-custom', 'text-white');
                        span.classList.add('border-gray-300');
                    });
                }
            }
        });
        
        document.getElementById('date-picker-trigger').addEventListener('click', () => {
            document.getElementById('date-range-input')._flatpickr.open();
        });

        // Fun√ß√£o para mostrar os detalhes da doa√ß√£o no modal
        function showDonationDetails(date) {
            const data = confirmedDonations[date];
            if (data) {
                modalDate.innerText = new Date(date).toLocaleDateString('pt-BR');
                modalAmount.innerText = data.amount;
                modalType.innerText = data.type;
                donationModal.classList.remove('hidden');
                donationModal.classList.add('flex');
            }
        }

        // Fun√ß√£o para fechar o modal
        closeModalBtn.onclick = () => {
            donationModal.classList.add('hidden');
            donationModal.classList.remove('flex');
        };

        // Dados e configura√ß√£o para o gr√°fico de barras
        const ctx = document.getElementById('barChart').getContext('2d');
        const myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    data: [],
                    backgroundColor: '#8B4513',
                    borderWidth: 0,
                    borderRadius: 5
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    x: {
                        grid: { display: false },
                        ticks: { font: { size: 10 } }
                    },
                    y: {
                        grid: { color: '#e0e0e0' },
                        ticks: { stepSize: 1, max: 7, font: { size: 10 } }
                    }
                }
            }
        });

        // Refer√™ncias para os elementos de data
        const startDateDisplay = document.getElementById('start-date-display');
        const endDateDisplay = document.getElementById('end-date-display');
        
        // Fun√ß√£o para atualizar o gr√°fico com base no filtro ou intervalo de datas
        function updateChartData(filter, dates = {}) {
            let labels = [];
            let data = [];
            let title = '';

            if (filter === 'range') {
                // L√≥gica de filtro por intervalo de datas
                title = `Doa√ß√µes de ${dates.startDate.toLocaleDateString('pt-BR')} a ${dates.endDate.toLocaleDateString('pt-BR')}`;
                // Exemplo simplificado: gera dados aleat√≥rios para o intervalo
                const diffDays = Math.ceil(Math.abs(dates.endDate - dates.startDate) / (1000 * 60 * 60 * 24));
                for(let i = 0; i < diffDays; i++) {
                    const currentDate = new Date(dates.startDate);
                    currentDate.setDate(dates.startDate.getDate() + i);
                    labels.push(currentDate.toLocaleDateString('pt-BR'));
                    data.push(Math.random() * 5 + 1); // Dados aleat√≥rios
                }
            } else {
                // L√≥gica dos filtros fixos (Dia, Semana, M√™s, Ano)
                switch(filter) {
                    case 'day':
                        labels = ['Manh√£', 'Tarde', 'Noite'];
                        data = [0.5, 1.2, 0.8];
                        title = 'Doa√ß√µes por Dia';
                        break;
                    case 'week':
                        labels = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b', 'Dom'];
                        data = [2, 1, 3, 2.5, 4, 1.5, 3];
                        title = 'Doa√ß√µes por Semana';
                        break;
                    case 'month':
                        labels = Object.keys(chartDataByMonth);
                        data = Object.values(chartDataByMonth);
                        title = 'Doa√ß√µes por M√™s';
                        break;
                    case 'year':
                        labels = ['2023', '2024', '2025'];
                        data = [50, 70, 65];
                        title = 'Doa√ß√µes por Ano';
                        break;
                }
            }

            myChart.data.labels = labels;
            myChart.data.datasets[0].data = data;
            myChart.options.scales.y.ticks.max = Math.max(...data) + 1; // Ajusta o m√°ximo do eixo Y
            myChart.update();

            // Atualiza os dados do gr√°fico atual para a gera√ß√£o do PDF
            currentChartData.labels = labels;
            currentChartData.data = data;
            currentChartData.title = title;
        }

        // Fun√ß√£o para atualizar a exibi√ß√£o das datas com base no filtro
        function updateDateDisplay(filter) {
            const today = new Date();
            const format = (date) => date.toLocaleDateString('pt-BR');
            let start, end;

            switch (filter) {
                case 'day':
                    start = today;
                    end = today;
                    break;
                case 'week':
                    start = new Date(today.setDate(today.getDate() - today.getDay()));
                    end = new Date(today.setDate(today.getDate() - today.getDay() + 6));
                    break;
                case 'month':
                    start = new Date(today.getFullYear(), today.getMonth(), 1);
                    end = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    break;
                case 'year':
                    start = new Date(today.getFullYear(), 0, 1);
                    end = new Date(today.getFullYear(), 11, 31);
                    break;
            }

            startDateDisplay.innerText = format(start);
            endDateDisplay.innerText = format(end);
        }

        // Adiciona event listeners aos filtros
        document.getElementById('filter-container').addEventListener('click', (event) => {
            const target = event.target;
            if (target.id.startsWith('filter-')) {
                document.querySelectorAll('#filter-container span').forEach(span => {
                    span.classList.remove('text-white', 'bg-brown-custom');
                    span.classList.add('bg-white', 'text-gray-600');
                });
                target.classList.remove('bg-white', 'text-gray-600');
                target.classList.add('bg-brown-custom', 'text-white');
                const filter = target.id.replace('filter-', '');
                updateChartData(filter);
                updateDateDisplay(filter);
            }
        });

        // Fun√ß√£o para gerar PDF do dashboard
        generatePdfBtn.addEventListener('click', () => {
            // Show loading overlay
            loadingOverlay.classList.remove('hidden');

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Adicionando t√≠tulo (formato ABNT-like)
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(16);
            doc.text("Relat√≥rio de Doa√ß√µes", 105, 20, null, null, 'center');
            
            // Subt√≠tulo din√¢mico
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(12);
            doc.text(currentChartData.title, 105, 30, null, null, 'center');

            // Data do relat√≥rio
            doc.setFontSize(10);
            doc.text("Data de Gera√ß√£o: " + new Date().toLocaleDateString('pt-BR'), 10, 40);
            
            // Resumo do desempenho
            doc.setFontSize(12);
            const totalDonations = currentChartData.data.reduce((sum, value) => sum + value, 0);
            const summaryText = `Este relat√≥rio apresenta um resumo das doa√ß√µes recebidas no per√≠odo. O total de doa√ß√µes registradas foi de ${totalDonations.toFixed(1)} unidades.`;
            
            const splitSummary = doc.splitTextToSize(summaryText, 190);
            doc.text(splitSummary, 10, 50);

            // T√≠tulo para a tabela de dados
            doc.setFontSize(12);
            doc.text("Dados Detalhados:", 10, 80);

            // Adicionando os dados do gr√°fico em formato de lista textual
            let y = 90;
            currentChartData.labels.forEach((label, index) => {
                const value = currentChartData.data[index];
                doc.text(`- ${label}: ${value} doa√ß√µes`, 15, y);
                y += 7;
            });
            
            doc.save("relatorio-doacoes.pdf");
            
            // Hide loading overlay
            loadingOverlay.classList.add('hidden');
        });

        // Chamada inicial para definir o estado padr√£o
        updateDateDisplay('month');
        renderPendingDonations();
        updateCalendar();
        updateDonationCounts();
        updateChartWithNewData('month');

        // Configura√ß√£o do mapa com Leaflet
        const map = L.map('map').setView([-14.235, -51.9253], 4);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        const locations = [
            [-15.7801, -47.9292], // Bras√≠lia
            [-23.5505, -46.6333], // S√£o Paulo
            [-22.9068, -43.1729], // Rio de Janeiro
            [-12.9714, -38.5014], // Salvador
            [-25.4284, -49.2733], // Curitiba
        ];

        locations.forEach(coord => {
            L.marker(coord).addTo(map);
        });
    </script>
</body>
</html>
